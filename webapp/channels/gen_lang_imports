#!/bin/node

const fs = require('fs');

let lines = '';
const langIDs = [];
const langFiles = {};

fs.readdirSync('./src/i18n').forEach(file => {
  if (file.endsWith('.json')) {
    langID = file.substr(0, file.indexOf('.json'));

    // Skip default language
    if (langID === 'en') {
      return
    }
    
    langIDs.push(langID);
    lines += `import ${langID.replace('-', '')} from './${file}';\n`;
    langFiles[langID] = langID.replace('-', '');
  }
});

// Simply replacing double quotes with single quotes.
lines += `\nexport const langIDs = ${JSON.stringify(langIDs)};\n`

// To generate the file exports we need to do a bit more work to handle ids with dashes and also output a map of literals rather than strings.
lines += '\nexport const langFiles = {' + Object.keys(langFiles).reduce((out, id, idx) => {
  if (id.includes('-')) {
    out += `'${id}':${langFiles[id]}`;
  } else {
    out += `${langFiles[id]}`;
  }

  if (idx !== (langIDs.length - 1)) {
    out += ',';
  }

  return out;
}, '') + '};';

const header = `// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.
// See LICENSE.txt for license information.\n\n// DO NOT EDIT - This file is generated by gen_lang_imports through the i18-extract script\n\n`;

fs.writeFileSync('./src/i18n/imports.ts', header+lines);

